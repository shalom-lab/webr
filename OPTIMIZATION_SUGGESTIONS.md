# ä»£ç ä¼˜åŒ–å»ºè®®

## ğŸ”´ é«˜ä¼˜å…ˆçº§ï¼ˆBug ä¿®å¤ï¼‰

### 1. æ‹¼å†™é”™è¯¯ä¿®å¤
**ä½ç½®**: `src/components/Term.vue:69`
- **é—®é¢˜**: `calss` åº”è¯¥æ˜¯ `class`
- **å½±å“**: CSS ç±»åæ— æ³•æ­£ç¡®åº”ç”¨

### 2. é‡å¤çš„ WebR åˆå§‹åŒ–
**ä½ç½®**: `src/components/Env.vue:169`
- **é—®é¢˜**: åœ¨ `Env.vue` ä¸­åˆè°ƒç”¨äº† `webR.init()`ï¼Œä½† `App.vue` å·²ç»åˆå§‹åŒ–äº†
- **å½±å“**: å¯èƒ½å¯¼è‡´é‡å¤åˆå§‹åŒ–é”™è¯¯æˆ–èµ„æºæµªè´¹
- **å»ºè®®**: ç§»é™¤ `Env.vue` ä¸­çš„ `webR.init()` è°ƒç”¨ï¼Œå› ä¸º WebR å·²ç»åœ¨ `App.vue` ä¸­åˆå§‹åŒ–

## ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ï¼ˆç”¨æˆ·ä½“éªŒï¼‰

### 3. æ·»åŠ  WebR åˆå§‹åŒ–åŠ è½½çŠ¶æ€
**ä½ç½®**: `src/App.vue`
- **é—®é¢˜**: WebR åˆå§‹åŒ–æ˜¯å¼‚æ­¥çš„ï¼Œç”¨æˆ·ä¸çŸ¥é“æ˜¯å¦åœ¨åŠ è½½
- **å»ºè®®**: 
  - æ·»åŠ åŠ è½½æç¤ºï¼ˆLoadingBar æˆ– Spinï¼‰
  - æ˜¾ç¤ºåˆå§‹åŒ–è¿›åº¦
  - åˆå§‹åŒ–å®Œæˆåæ˜¾ç¤ºæˆåŠŸæç¤º

### 4. æ”¹è¿›é”™è¯¯å¤„ç†
**ä½ç½®**: å¤šä¸ªç»„ä»¶
- **é—®é¢˜**: é”™è¯¯å¤„ç†è¿‡äºç®€å•ï¼Œåªæœ‰ `message.error('runR error')`
- **å»ºè®®**:
  - æ˜¾ç¤ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
  - åŒºåˆ†ä¸åŒç±»å‹çš„é”™è¯¯ï¼ˆç½‘ç»œé”™è¯¯ã€è¯­æ³•é”™è¯¯ã€è¿è¡Œæ—¶é”™è¯¯ç­‰ï¼‰
  - æä¾›é”™è¯¯æ¢å¤å»ºè®®

### 5. ä¼˜åŒ–æ— é™å¾ªç¯çš„é”™è¯¯å¤„ç†
**ä½ç½®**: `src/components/Term.vue:62`
- **é—®é¢˜**: `for (; ;)` æ— é™å¾ªç¯è¯»å–è¾“å‡ºï¼Œå¦‚æœå‡ºé”™ä¼šå¯¼è‡´å¾ªç¯ä¸­æ–­
- **å»ºè®®**:
  - æ·»åŠ  try-catch åŒ…è£¹
  - å¤„ç† `closed` æ¶ˆæ¯ç±»å‹ï¼Œæ­£ç¡®é€€å‡ºå¾ªç¯
  - æ·»åŠ é‡è¿æœºåˆ¶

## ğŸŸ¢ ä½ä¼˜å…ˆçº§ï¼ˆä»£ç è´¨é‡ï¼‰

### 6. æå–å…¬å…±å‡½æ•°
**ä½ç½®**: å¤šä¸ªç»„ä»¶
- **é—®é¢˜**: `runR` å‡½æ•°åœ¨ `Term.vue` å’Œ `Env.vue` ä¸­é‡å¤å®šä¹‰
- **å»ºè®®**: 
  - åˆ›å»º `src/utils/webr.js` å·¥å…·æ–‡ä»¶
  - æå–å…¬å…±çš„ WebR æ“ä½œå‡½æ•°
  - ç»Ÿä¸€é”™è¯¯å¤„ç†é€»è¾‘

### 7. æ”¹è¿›å˜é‡å‘½å
**ä½ç½®**: `src/components/Term.vue`
- **é—®é¢˜**: å˜é‡å `msg` ä¸å¤Ÿæ˜ç¡®
- **å»ºè®®**: ä½¿ç”¨æ›´æè¿°æ€§çš„åç§°ï¼Œå¦‚ `outputMessages` æˆ– `formattedOutput`

### 8. æ·»åŠ  TypeScript æˆ– JSDoc
**ä½ç½®**: æ‰€æœ‰æ–‡ä»¶
- **å»ºè®®**: 
  - æ·»åŠ  JSDoc æ³¨é‡Š
  - æˆ–è€…è€ƒè™‘è¿ç§»åˆ° TypeScript
  - æé«˜ä»£ç å¯ç»´æŠ¤æ€§

### 9. ä¼˜åŒ–ç¼“å­˜ç­–ç•¥
**ä½ç½®**: `vite.config.js`
- **å»ºè®®**:
  - è€ƒè™‘ä½¿ç”¨ `StaleWhileRevalidate` ç­–ç•¥æ›¿ä»£éƒ¨åˆ† `CacheFirst`
  - æ·»åŠ ç¼“å­˜ç‰ˆæœ¬æ§åˆ¶
  - ä¼˜åŒ–ç¼“å­˜è¿‡æœŸæ—¶é—´

### 10. æ·»åŠ æ€§èƒ½ç›‘æ§
**ä½ç½®**: å…¨å±€
- **å»ºè®®**:
  - æ·»åŠ  WebR åˆå§‹åŒ–æ—¶é—´ç»Ÿè®¡
  - ç›‘æ§ R ä»£ç æ‰§è¡Œæ—¶é—´
  - è®°å½•ç¼“å­˜å‘½ä¸­ç‡

## ğŸ“‹ ä¼˜åŒ–å®æ–½ä¼˜å…ˆçº§

1. **ç«‹å³ä¿®å¤**ï¼ˆå½±å“åŠŸèƒ½ï¼‰:
   - âœ… ä¿®å¤æ‹¼å†™é”™è¯¯ `calss` â†’ `class`
   - âœ… ç§»é™¤é‡å¤çš„ `webR.init()` è°ƒç”¨

2. **çŸ­æœŸä¼˜åŒ–**ï¼ˆæå‡ä½“éªŒï¼‰:
   - æ·»åŠ åŠ è½½çŠ¶æ€æç¤º
   - æ”¹è¿›é”™è¯¯å¤„ç†
   - ä¼˜åŒ–æ— é™å¾ªç¯çš„é”™è¯¯å¤„ç†

3. **é•¿æœŸä¼˜åŒ–**ï¼ˆä»£ç è´¨é‡ï¼‰:
   - æå–å…¬å…±å‡½æ•°
   - æ”¹è¿›ä»£ç ç»“æ„
   - æ·»åŠ ç±»å‹å®šä¹‰

## ğŸ¯ å…·ä½“ä¼˜åŒ–ç¤ºä¾‹

### ç¤ºä¾‹ 1: ä¿®å¤æ‹¼å†™é”™è¯¯
```vue
// ä¿®æ”¹å‰
termRef.value.pushMessage({ type: 'normal', content: output.data, calss: 'error' })

// ä¿®æ”¹å
termRef.value.pushMessage({ type: 'normal', content: output.data, class: 'error' })
```

### ç¤ºä¾‹ 2: æ·»åŠ åŠ è½½çŠ¶æ€
```vue
// App.vue
const loading = ref(true)
const loadingBar = useLoadingBar()

onMounted(async () => {
  loadingBar.start()
  try {
    await webR.init({ channelType })
    loadingBar.finish()
    message.success('WebR åˆå§‹åŒ–æˆåŠŸ')
  } catch (error) {
    loadingBar.error()
    // é”™è¯¯å¤„ç†...
  } finally {
    loading.value = false
  }
})
```

### ç¤ºä¾‹ 3: æå–å…¬å…±å‡½æ•°
```javascript
// src/utils/webr.js
export async function runRCode(webR, code, options = {}) {
  const shelter = await new webR.Shelter();
  try {
    const result = await shelter.captureR(code, {
      withAutoprint: true,
      captureStreams: true,
      captureConditions: true,
      env: webR.objs.globalEnv,
      ...options
    });
    return result;
  } finally {
    shelter.purge();
  }
}
```


